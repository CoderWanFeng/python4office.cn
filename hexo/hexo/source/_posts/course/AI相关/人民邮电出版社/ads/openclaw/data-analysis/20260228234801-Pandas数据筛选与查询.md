---
title: Pandas数据筛选：我用这5种方法，从百万行销售数据中秒查目标订单
date: 2026-02-28 23:48:00
tags: [数据分析, Pandas, 数据筛选, 查询, 销售分析]
---

<p align="center" id='扫码查看 AI 编程训练营'>
    <a target="_blank" href='https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ'>
    <img src="https://raw.atomgit.com/user-images/assets/5027920/9209df5a-99d2-40dc-af34-b10b43be9026/12-ai.jpg" />
    </a>   
</p>

<p align="center" name="atomgit">
    <a target="_blank" href='https://github.com/CoderWanFeng/python-office'>
    <img src="https://img.shields.io/github/stars/CoderWanFeng/python-office.svg?style=social" alt="github star"/>
    </a>
    	<a target="_blank" href='https://gitee.com/CoderWanFeng//python-office/'>
		<img src='https://gitee.com/CoderWanFeng//python-office/badge/star.svg?theme=dark' alt='gitee star'/>
	</a>
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
		<img src='https://atomgit.com/CoderWanFeng1/python-office/star/2025top.svg?theme=dark' alt='atomgit star'/>
	</a>	
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
<img src="https://static.pepy.tech/badge/python-office" alt="PyPI Downloads">
</a>
<a href="https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ">
  <img src="https://img.shields.io/badge/学习-AI 编程-red" alt="AI 编程">
</a>
    	<a href="http://www.python4office.cn/wechat-group/">
  <img src="https://img.shields.io/badge/加入-AI 交流群-brightgreen" alt="AI 交流群">
</a>

</p>

<!-- more -->

大家好，我是正在实战各种<a href="https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ" target="_blank">AI项目</a>的程序员晚枫。

今天学习**Pandas数据筛选与查询**，这是数据分析最频繁的操作。

掌握这5种方法，无论数据量多大，你都能快速找到想要的数据。这些技巧在**项目1：销售数据分析报表自动化**中会大量使用。

---

## 准备数据

```python
import pandas as pd
import numpy as np

# 创建电商销售数据示例（与项目1数据格式一致）
np.random.seed(42)

# 生成30天的销售数据
dates = pd.date_range(start='2024-01-01', periods=30, freq='D')

data = []
for date in dates:
    n_orders = np.random.randint(5, 15)
    for _ in range(n_orders):
        data.append({
            '订单ID': f"ORD{np.random.randint(100000, 999999)}",
            '日期': date,
            '产品类别': np.random.choice(['电子产品', '服装', '食品', '家居']),
            '产品名称': np.random.choice(['iPhone', 'T恤', '零食', '杯子', '耳机', '鞋子']),
            '单价': np.random.randint(50, 5000),
            '数量': np.random.randint(1, 5),
            '地区': np.random.choice(['华北', '华东', '华南', '西南']),
            '销售员': np.random.choice(['张三', '李四', '王五', '赵六', '钱七'])
        })

df = pd.DataFrame(data)
df['金额'] = df['单价'] * df['数量']

print(f"数据集大小: {len(df)} 条销售记录")
print("\n前5行数据:")
print(df.head())
```

---

## 方法1：布尔索引（最常用）

```python
# 单条件筛选：金额大于1000的订单
high_value = df[df['金额'] > 1000]
print(f"高价值订单: {len(high_value)} 条")

# 多条件：与 (&) - 电子产品且金额大于2000
tech_high = df[(df['产品类别'] == '电子产品') & (df['金额'] > 2000)]

# 多条件：或 (|) - 华北或华东地区的订单
north_east = df[(df['地区'] == '华北') | (df['地区'] == '华东')]

# 非 (~) - 排除食品类订单
not_food = df[~(df['产品类别'] == '食品')]

print("高价值订单示例:")
print(high_value[['订单ID', '产品名称', '金额']].head())
```

---

## 方法2：isin - 多值匹配

```python
# 匹配多个产品类别（比多个或条件简洁）
selected_categories = df[df['产品类别'].isin(['电子产品', '家居'])]

# 匹配多个地区
hot_regions = df[df['地区'].isin(['华北', '华东', '华南'])]

# 结合取反 - 排除某些地区
not_southwest = df[~df['地区'].isin(['西南'])]

print(f"选中类别订单数: {len(selected_categories)}")
print(f"热门地区订单数: {len(hot_regions)}")
```

---

## 方法3：query - 类SQL语法

```python
# 简单查询：金额大于1000
result = df.query('金额 > 1000')

# 多条件：电子产品且金额大于2000
result = df.query('产品类别 == "电子产品" and 金额 > 2000')

# 使用变量
min_amount = 1500
result = df.query('金额 > @min_amount')  # @表示外部变量

# 字符串匹配：订单ID包含特定数字
result = df.query('订单ID.str.contains("123")', engine='python')

print(f"Query筛选结果: {len(result)} 条")
```

**优点**：代码可读性更好，特别是复杂条件时。

---

## 方法4：loc - 标签索引

```python
# 设置订单ID为索引（方便演示）
df_indexed = df.set_index('订单ID')

# 选择单行
print("单个订单详情:")
print(df_indexed.iloc[0])  # 第一行

# 选择多行
print("\n前3个订单:")
print(df_indexed.iloc[0:3])

# 行列同时选择 - 只看产品名称和金额两列
print("\n指定列:")
print(df_indexed.iloc[0:5][['产品名称', '金额']])

# 条件筛选 + 列选择
print("\n高价值订单的产品和地区:")
print(df_indexed.loc[df_indexed['金额'] > 2000, ['产品类别', '地区', '金额']].head())
```

---

## 方法5：iloc - 位置索引

```python
# 第0行
print("第1条记录:")
print(df.iloc[0])

# 前5行
print("\n前5条记录:")
print(df.iloc[0:5])

# 特定行
print("\n第1、3、5条记录:")
print(df.iloc[[0, 2, 4]])

# 行列切片 - 前10行的前4列
print("\n前10行前4列:")
print(df.iloc[0:10, 0:4])

# 倒数几行
print("\n最后3条记录:")
print(df.iloc[-3:])
```

---

## 字符串匹配筛选

```python
# 产品名称包含"iPhone"
iphone_orders = df[df['产品名称'].str.contains('iPhone', na=False)]

# 以特定字符开头
ord_orders = df[df['订单ID'].str.startswith('ORD1', na=False)]

# 正则表达式 - 订单ID中间是234
pattern_orders = df[df['订单ID'].str.match(r'ORD234.*', na=False)]

print(f"iPhone订单数: {len(iphone_orders)}")
print(f"ORD1开头订单数: {len(ord_orders)}")
```

---

## 日期筛选

```python
# 筛选某天的数据
day_orders = df[df['日期'] == '2024-01-15']

# 筛选某月的数据
df['月份'] = df['日期'].dt.month
jan_orders = df[df['月份'] == 1]

# 日期范围
range_orders = df[(df['日期'] >= '2024-01-10') & (df['日期'] <= '2024-01-20')]

# 最近N天
from datetime import datetime, timedelta
recent = df[df['日期'] >= df['日期'].max() - timedelta(days=7)]

print(f"1月订单数: {len(jan_orders)}")
print(f"日期范围内订单数: {len(range_orders)}")
print(f"最近7天订单数: {len(recent)}")
```

---

## 高效技巧

### 1. 链式操作
```python
# 不推荐：多次赋值
filtered = df[df['产品类别'] == '电子产品']
result = filtered[filtered['金额'] > 2000]
result = result.sort_values('金额', ascending=False)

# 推荐：链式写法（一行搞定）
result = (df[df['产品类别'] == '电子产品']
            .query('金额 > 2000')
            .sort_values('金额', ascending=False))

print("链式操作结果:")
print(result[['产品名称', '金额', '地区']].head())
```

### 2. 使用copy避免警告
```python
# 会出现SettingWithCopyWarning
subset = df[df['产品类别'] == '电子产品']
subset['折扣'] = 0.9  # 警告！

# 正确做法
subset = df[df['产品类别'] == '电子产品'].copy()
subset['折扣'] = 0.9  # 没问题
```

### 3. 重置索引
```python
# 筛选后索引不连续
filtered = df[df['金额'] > 2000]
print(f"原索引: {list(filtered.index[:5])}")  # 可能是不连续的

# 重置索引
filtered = filtered.reset_index(drop=True)
print(f"新索引: {list(filtered.index[:5])}")  # 0, 1, 2, 3, 4
```

---

## 实战：销售数据复杂筛选场景

```python
# 场景：找出华东区、电子产品、金额大于3000、由张三或李四销售的高价值订单
# 用于：计算高价值订单占比、给优秀销售员发奖金

# 复杂筛选
high_value_orders = (
    df[
        (df['地区'] == '华东') &
        (df['产品类别'] == '电子产品') &
        (df['金额'] > 3000) &
        (df['销售员'].isin(['张三', '李四']))
    ]
    .sort_values('金额', ascending=False)
    .reset_index(drop=True)
)

print(f"符合条件的高价值订单: {len(high_value_orders)} 条")
print("\n订单详情:")
print(high_value_orders[['订单ID', '产品名称', '金额', '销售员', '日期']])

# 统计这些订单的总金额
total_amount = high_value_orders['金额'].sum()
print(f"\n这些订单总金额: ¥{total_amount:,.0f}")

# 按销售员分组统计
sales_by_person = high_value_orders.groupby('销售员').agg({
    '订单ID': 'count',
    '金额': 'sum'
}).rename(columns={'订单ID': '订单数'})
print("\n按销售员统计:")
print(sales_by_person)
```

---

## 下节预告

下一课我们将学习**数据清洗-处理缺失值**，这是数据分析中最重要的环节。干净的输入才有可靠的输出。

👉 **[继续阅读：Pandas数据清洗-处理缺失值](/course/AI相关/人民邮电出版社/ads/openclaw/data-analysis/20260228234901-Pandas数据清洗-处理缺失值/)**

---

## 💬 加入学习交流群

扫码加入**Python学习交流群**，和数千名同学一起进步：

👉 **[点击加入交流群](http://www.python4office.cn/wechat-group/)**

群里不定期分享：
- 数据分析实战案例
- Python学习资料
- 求职面试经验
- 行业最新动态

---

## 推荐：AI Python数据分析实战营

🎁 **限时福利**：送《利用Python进行数据分析》实体书

👉 **[点击了解详情](https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ)**

---

## 课程导航

**上一篇：** [Pandas数据读取与保存](/course/AI相关/人民邮电出版社/ads/openclaw/data-analysis/20260228232101-Pandas数据读取与保存/)

**下一篇：** [Pandas数据清洗-处理缺失值](/course/AI相关/人民邮电出版社/ads/openclaw/data-analysis/20260228234901-Pandas数据清洗-处理缺失值/)

---

*PS：数据筛选是日常工作中最高频的操作。熟练掌握这5种方法，效率提升10倍。这些技巧在项目1的销售报表自动化中会大量用到。*
