---
title: Python异常处理：我写了5年代码，总结的异常处理最佳实践
date: 2026-02-28 18:59:00
tags: [Python基础, 异常处理, 调试]
---

<p align="center" id='扫码查看 AI 编程训练营'>
    <a target="_blank" href='https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ'>
    <img src="https://raw.atomgit.com/user-images/assets/5027920/9209df5a-99d2-40dc-af34-b10b43be9026/12-ai.jpg" />
    </a>   
</p>

<p align="center" name="atomgit">
    <a target="_blank" href='https://github.com/CoderWanFeng/python-office'>
    <img src="https://img.shields.io/github/stars/CoderWanFeng/python-office.svg?style=social" alt="github star"/>
    </a>
    	<a target="_blank" href='https://gitee.com/CoderWanFeng//python-office/'>
		<img src='https://gitee.com/CoderWanFeng//python-office/badge/star.svg?theme=dark' alt='gitee star'/>
	</a>
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
		<img src='https://atomgit.com/CoderWanFeng1/python-office/star/2025top.svg?theme=dark' alt='atomgit star'/>
	</a>	
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
<img src="https://static.pepy.tech/badge/python-office" alt="PyPI Downloads">
</a>
<a href="https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ">
  <img src="https://img.shields.io/badge/学习-AI 编程-red" alt="AI 编程">
</a>
    	<a href="http://www.python4office.cn/wechat-group/">
  <img src="https://img.shields.io/badge/加入-AI 交流群-brightgreen" alt="AI 交流群">
</a>

</p>

<!-- more -->

大家好，我是正在实战各种AI项目的程序员晚枫。

今天聊一个让新手头疼、老手也容易忽视的话题——**异常处理**。

你可能遇到过这种情况：程序跑着跑着突然崩溃，满屏红色报错信息，却不知道哪里出了问题。

其实，只要掌握正确的异常处理方法，你的程序就能优雅地处理错误，而不是直接挂掉。

这篇文章总结了我在5年编程生涯中积累的异常处理最佳实践。

---

## 什么是异常？

简单说，**异常就是程序运行时出现的错误**。

### 常见异常类型
```python
# ZeroDivisionError - 除以零
print(10 / 0)

# FileNotFoundError - 文件不存在
open('不存在的文件.txt', 'r')

# ValueError - 值错误
int("abc")

# TypeError - 类型错误
len(123)

# KeyError - 字典key不存在
{"a": 1}["b"]

# IndexError - 索引越界
[1, 2, 3][10]
```

---

## 基础：try-except

### 最简单的捕获
```python
try:
    result = 10 / 0
except:
    print("出错了！")
```

**问题**：捕获所有异常是坏习惯，会隐藏真正的bug。

### 捕获特定异常
```python
try:
    result = 10 / 0
except ZeroDivisionError:
    print("不能除以零！")
```

### 获取异常信息
```python
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"错误：{e}")
```

---

## 进阶：多个except

```python
try:
    # 可能产生多种异常的代码
    number = int(input("请输入数字："))
    result = 100 / number
    print(f"结果是：{result}")
    
except ValueError:
    print("输入必须是数字！")
    
except ZeroDivisionError:
    print("不能输入零！")
    
except Exception as e:
    print(f"未知错误：{e}")
```

**注意**：顺序很重要！子类异常要放在父类前面。

---

## 完整结构：try-except-else-finally

```python
try:
    # 尝试执行的代码
    file = open('data.txt', 'r')
    content = file.read()
    
except FileNotFoundError:
    # 发生异常时执行
    print("文件不存在！")
    
else:
    # 没有异常时执行
    print(f"文件内容：{content}")
    
finally:
    # 无论是否异常都执行（清理工作）
    if 'file' in locals() and not file.closed:
        file.close()
        print("文件已关闭")
```

---

## 自定义异常

当内置异常不够用的时候，可以自定义：

```python
class ValidationError(Exception):
    """数据验证错误"""
    pass

class AgeError(ValidationError):
    """年龄不合法"""
    def __init__(self, age, message="年龄必须在0-150之间"):
        self.age = age
        self.message = message
        super().__init__(self.message)

# 使用
def set_age(age):
    if not 0 <= age <= 150:
        raise AgeError(age)
    return age

try:
    set_age(200)
except AgeError as e:
    print(f"错误：{e}，你输入了{e.age}")
```

---

## 最佳实践

### ✅ 应该做的

1. **具体捕获，不要裸except**
```python
# 好的做法
except (ValueError, TypeError) as e:
    logger.error(f"参数错误：{e}")

# 坏的做法（会捕获KeyboardInterrupt等）
except:
    pass
```

2. **记录日志，不要静默处理**
```python
import logging

logging.basicConfig(level=logging.ERROR)

try:
    risky_operation()
except Exception as e:
    logging.error(f"操作失败：{e}", exc_info=True)
    raise  # 重新抛出，或者返回错误信息
```

3. **使用上下文管理器**
```python
# 自动处理资源释放
with open('file.txt', 'r') as f:
    content = f.read()
```

### ❌ 不应该做的

1. **不要裸except**
```python
try:
    do_something()
except:  # 不要这样！
    pass
```

2. **不要忽略异常**
```python
try:
    important_operation()
except Exception:
    pass  # 错误被吞掉了，没人知道发生了什么！
```

3. **不要过度使用异常控制流程**
```python
# 不要用异常代替条件判断
try:
    value = my_dict[key]
except KeyError:
    value = default

# 应该用
value = my_dict.get(key, default)
```

---

## 实战：健壮的API请求

```python
import requests
from requests.exceptions import RequestException, Timeout

def fetch_data(url, max_retries=3):
    """带重试机制的HTTP请求"""
    for attempt in range(max_retries):
        try:
            response = requests.get(url, timeout=5)
            response.raise_for_status()  # 检查HTTP错误
            return response.json()
            
        except Timeout:
            if attempt < max_retries - 1:
                print(f"超时，第{attempt + 1}次重试...")
                continue
            raise
            
        except RequestException as e:
            print(f"请求失败：{e}")
            raise
            
    return None

# 使用
try:
    data = fetch_data('https://api.example.com/data')
    print(data)
except Exception as e:
    print(f"获取数据失败：{e}")
```

---

## 推荐：AI Python零基础实战营

想系统学习Python异常处理和调试技巧？

**课程内容：**
- ✅ Python基础语法
- ✅ 异常处理与调试
- ✅ 日志记录最佳实践
- ✅ 实战项目练习

🎁 **限时福利**：送《Python编程从入门到实践》实体书

👉 **[点击了解详情](https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ)**

---

## 相关阅读

- [Python文件操作：读写文件的10种姿势](/course/AI相关/人民邮电出版社/ads/openclaw/python/20260228185801-Python文件操作-读写文件的10种姿势/)
- [Python字符串：我被忽略的20个实用方法](/course/AI相关/人民邮电出版社/ads/openclaw/python/20260228185701-Python字符串-被忽略的20个实用方法/)
- [Python装饰器：给函数加功能的黑魔法](/course/AI相关/人民邮电出版社/ads/openclaw/python/20260228173001-Python装饰器-给函数加功能的黑魔法/)

---

*PS：好的异常处理能让程序更健壮。记住原则：具体捕获、记录日志、优雅降级。*
