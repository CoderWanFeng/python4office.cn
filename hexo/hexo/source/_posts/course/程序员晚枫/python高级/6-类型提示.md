---
title: ç¬¬ 6 è®² æ•°æ®ç±»ä¸ç±»å‹æç¤ºå·¥ç¨‹åŒ–  
date: 2025-07-20 06:41:49
tags: [ç¬¬ä¸‰æ–¹åº“,pyinstaller]
---




<p align="center" id='è¿›ç¾¤-banner-AI'>
    <a target="_blank" href='http://www.python4office.cn/wechat-group/'>
    <img src="https://raw.atomgit.com/user-images/assets/5027920/87fc1ca4-1a6c-47b8-b234-3e323a1aa827/aiq.jpg" width="100%"/>
    </a>   
</p>

<p align="center">
	ğŸ‘‰ <a target="_blank" href="https://www.python-office.com/">é¡¹ç›®å®˜ç½‘ï¼šhttps://www.python-office.com/</a> ğŸ‘ˆ
</p>
<p align="center">
	ğŸ‘‰ <a target="_blank" href="http://www.python4office.cn/wechat-group/">æœ¬å¼€æºé¡¹ç›®çš„äº¤æµç¾¤</a> ğŸ‘ˆ
</p>



<p align="center" name="atomgit">
  <a target="_blank" href='https://github.com/CoderWanFeng/python-office'>
    <img src="https://img.shields.io/github/stars/CoderWanFeng/python-office.svg?style=social" alt="github star"/>
    </a>
    	<a target="_blank" href='https://gitee.com/CoderWanFeng//python-office/'>
		<img src='https://gitee.com/CoderWanFeng//python-office/badge/star.svg?theme=dark' alt='gitee star'/>
	</a>
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
		<img src='https://atomgit.com/CoderWanFeng1/python-office/star/2025top.svg?theme=dark' alt='atomgit star'/>
	</a>	
</p>
<p align="center" name="atomgit">
	<a href="https://mp.weixin.qq.com/s/b6fpU-oXSo8qKP_Nc8w0Zg">
  <img src="https://img.shields.io/badge/å­¦ä¹ -AIç¼–ç¨‹-red" alt="AIç¼–ç¨‹">
</a>
    	<a href="http://www.python4office.cn/wechat-group/">
  <img src="https://img.shields.io/badge/åŠ å…¥-AIäº¤æµç¾¤-brightgreen" alt="AIäº¤æµç¾¤">
</a>

</p>

<!-- more -->



å¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ç¨‹åºå‘˜æ™šæ«ï¼Œæ­£åœ¨all in [å„ç§AIé¡¹ç›®](https://mp.weixin.qq.com/s/XQhCrkbumDqtOZXuapMpVg)ï¼Œå…¨ç½‘åŒåã€‚


ï¼ˆ3 h ç›´æ’­ / å½•æ’­å¯æ‹† 2 æ¬¡ï¼‰

ç›®æ ‡  
â€¢ æŠŠ `dataclasses` ç©å‡ºèŠ±ï¼šé»˜è®¤å€¼ã€ç»§æ‰¿ã€è½¬æ¢ã€åºåˆ—åŒ–ä¸€æ¡é¾™  
â€¢ ç”¨ `typing` æ–°ç‰¹æ€§ + `mypy` åš CI çº§ç±»å‹æ£€æŸ¥  
â€¢ å†™ä¸€ä¸ªâ€œè¿è¡Œæ—¶æ ¡éªŒ + JSON ç”Ÿæˆâ€çš„è¿·ä½  DTO æ¡†æ¶ï¼Œå¹¶æ‚„æ‚„æ¤å…¥ã€Œç¨‹åºå‘˜æ™šæ«ã€å½©è›‹

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.0 å¼€åœº 2 min  
â€œå†™ä»£ç ä¸å†™ç±»å‹ï¼Œå°±åƒæ³¡é¢ä¸æ”¾è°ƒæ–™åŒ…â€”â€”èƒ½è·‘ï¼Œä½†å‘³é“å·®ã€‚â€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.1 `dataclasses` é€Ÿé€šï¼ˆ15 minï¼‰  
6.1.1 åŸºç¡€å†™æ³•  
```python
from dataclasses import dataclass

@dataclass
class User:
    id: int
    name: str
    vip: bool = False
```

6.1.2 ç»§æ‰¿ & é»˜è®¤å€¼å·¥å‚  
```python
@dataclass
class Config:
    db: dict = field(default_factory=dict)   # å¯å˜é»˜è®¤å€¼
```

6.1.3 `__post_init__` é’©å­  
```python
@dataclass
class Circle:
    r: float
    area: float = field(init=False)

    def __post_init__(self):
        self.area = 3.1416 * self.r ** 2
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.2 typing æ–°ç‰¹æ€§ 25 min  
6.2.1 `Literal`ã€`TypedDict`ã€`Protocol`  
```python
from typing import Literal, TypedDict, Protocol

class Movie(TypedDict):
    title: str
    year: int
    genre: Literal["comedy", "drama", "action"]

class Drawable(Protocol):
    def draw(self) -> None: ...
```

6.2.2 mypy æ¸è¿›å¼æ£€æŸ¥  
```bash
poetry add mypy pre-commit
```
```yaml
# .pre-commit-config.yaml
- repo: https://github.com/pre-commit/mirrors-mypy
  rev: v1.8.0
  hooks:
    - id: mypy
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.3 å®æˆ˜ï¼šè¿è¡Œæ—¶æ ¡éªŒ + JSON åºåˆ—åŒ–ï¼ˆ45 minï¼‰  
éœ€æ±‚ï¼šä¸€ä¸ª DTO æ—¢èƒ½è¢« mypy é™æ€æ£€æŸ¥ï¼Œåˆèƒ½åœ¨è¿è¡Œæ—¶æ ¡éªŒã€‚  
6.3.1 ç¯å¢ƒå‡†å¤‡  
```bash
poetry add pydantic[email]
```

6.3.2 ç”¨ `dataclass` + `pydantic` æ··æ­  
```python
from dataclasses import dataclass
from pydantic import BaseModel, Field, validator

@dataclass
class Address:
    street: str
    city: str

class UserDTO(BaseModel):
    id: int = Field(gt=0)
    name: str = Field(min_length=2, max_length=16)
    email: str
    address: Address

    @validator('email')
    def valid_email(cls, v):
        if '@' not in v:
            raise ValueError('ç¨‹åºå‘˜æ™šæ«æç¤ºï¼šé‚®ç®±æ ¼å¼ä¸å¯¹å“¦')
        return v

# è¿è¡Œ
user = UserDTO(id=1, name="æ™šæ«", email="wanfeng@example.com", address=Address("ä¸­å…³æ‘", "åŒ—äº¬"))
print(user.json(indent=2))
```

6.3.3 å½©è›‹ï¼šJSON è¾“å‡ºå¸¦ç­¾å  
```python
data = user.dict()
data["_source"] = "ç¨‹åºå‘˜æ™šæ«ä¸“å± DTO"
print(data)
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.4 æ³›å‹æ•°æ®ç±»ï¼ˆ20 minï¼‰  
```python
from typing import TypeVar, Generic

T = TypeVar('T')

@dataclass
class Page(Generic[T]):
    items: list[T]
    total: int
    page: int

p: Page[UserDTO] = Page(items=[user], total=1, page=1)
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.5 ç”¨ `mypy` åš CIï¼ˆ20 minï¼‰  
GitHub Action æ¨¡æ¿ï¼š  
```yaml
name: type-check
on: [push, pull_request]
jobs:
  mypy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: {python-version: '3.12'}
      - run: pip install poetry
      - run: poetry install
      - run: poetry run mypy src/
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.6 ç»¼åˆæ¡ˆä¾‹ï¼šé…ç½®æ–‡ä»¶â†’DTOâ†’JSON Schemaï¼ˆ30 minï¼‰  
éœ€æ±‚ï¼šYAML é…ç½® â†’ è¿è¡Œæ—¶æ ¡éªŒ â†’ å¯¼å‡º JSON Schema ç»™å‰ç«¯ã€‚  
```python
import yaml
from pydantic import BaseModel, Field

class Settings(BaseModel):
    debug: bool = False
    db_url: str = Field(regex=r'^postgresql://')
    max_workers: int = Field(ge=1, le=100)

    class Config:
        # å½©è›‹ï¼šé»˜è®¤é…ç½®æ¥æº
        json_schema_extra = {"description": "ç”±ç¨‹åºå‘˜æ™šæ«è‡ªåŠ¨ç”Ÿæˆ"}

with open('settings.yaml') as f:
    cfg = Settings(**yaml.safe_load(f))

print(cfg.schema_json(indent=2))   # å‰ç«¯æ‹¿åˆ° schema ç›´æ¥æ¸²æŸ“è¡¨å•
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.7 è°ƒè¯•æŠ€å·§ï¼ˆ10 minï¼‰  
â€¢ VS Code è°ƒè¯•ï¼šåœ¨ `__post_init__` æ‰“æ–­ç‚¹  
â€¢ `pydantic` è°ƒè¯•æ¨¡å¼ï¼š`export PYDANTIC_DEV_MODE=1`

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.8 å°ç»“ & æ€ç»´å¯¼å›¾ï¼ˆ5 minï¼‰  
dataclass â†’ typing â†’ mypy â†’ pydantic â†’ JSON Schema â†’ CI

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
6.9 è¯¾åä½œä¸š  
1. å¿…åšï¼šæŠŠä»Šæ—¥ `UserDTO` æ‹†æˆ `CreateUserDTO` ä¸ `UpdateUserDTO`ï¼Œå¹¶å†™ `pytest` å‚æ•°åŒ–æµ‹è¯•ã€‚  
2. é€‰åšï¼šç”¨ `dataclass` å†™ä¸€ä¸ªæ”¯æŒåˆ†é¡µã€æ’åºã€è¿‡æ»¤çš„é€šç”¨æŸ¥è¯¢ DTOã€‚  
3. å½©è›‹ï¼šåœ¨ JSON Schema çš„ `description` é‡ŒåŠ å…¥ã€Œç¨‹åºå‘˜æ™šæ«ã€ä¸“å±å£å·ã€‚

æäº¤ï¼š  
â€¢ ä»£ç  push åˆ° `feat/lesson6`  
â€¢ CI è‡ªåŠ¨è·‘ `mypy --strict` + `pytest`

ï¼ˆç¬¬ 6 è®²å®Œï¼‰

----

å¤§å®¶åœ¨å­¦ä¹ è¯¾ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿+å¾®ä¿¡å’Œæˆ‘äº¤æµğŸ‘‰[æˆ‘çš„è”ç³»æ–¹å¼ï¼šå¾®ä¿¡ã€è¯»è€…ç¾¤ã€1å¯¹1ã€ç¦åˆ©](http://www.python4office.cn/wechat-qrcode/)


![](https://cos.python-office.com/ads/gzh/sub-py.jpg)

![æ‰«ä¸€æ‰«ï¼Œé¢†çº¢åŒ…](https://raw.atomgit.com/user-images/assets/5027920/fad13012-c22f-4c3a-b56e-c70787a55699/172ca166340cd6d0f52d356402901d4f.jpg '6152d8017a3595256e51cbd9e08e148b.png')
  
![ç¾å›¢çº¢åŒ…](https://raw.atomgit.com/user-images/assets/5027920/6aa9a60e-bb4a-423c-a75d-cbd6ecf6f370/4dbea2fec93c415c75311666f19a1022.jpg '6d283319df13b09a3f74a9f19bf18a97.jpg')



