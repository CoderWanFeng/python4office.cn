---
title: ç¬¬ 3 è®² ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸èµ„æºæ²»ç†  
date: 2025-07-20 03:41:49
tags: [ç¬¬ä¸‰æ–¹åº“,pyinstaller]
---




<p align="center" id='è¿›ç¾¤-banner-AI'>
    <a target="_blank" href='http://www.python4office.cn/wechat-group/'>
    <img src="https://raw.atomgit.com/user-images/assets/5027920/87fc1ca4-1a6c-47b8-b234-3e323a1aa827/aiq.jpg" width="100%"/>
    </a>   
</p>

<p align="center">
	ğŸ‘‰ <a target="_blank" href="https://www.python-office.com/">é¡¹ç›®å®˜ç½‘ï¼šhttps://www.python-office.com/</a> ğŸ‘ˆ
</p>
<p align="center">
	ğŸ‘‰ <a target="_blank" href="http://www.python4office.cn/wechat-group/">æœ¬å¼€æºé¡¹ç›®çš„äº¤æµç¾¤</a> ğŸ‘ˆ
</p>



<p align="center" name="atomgit">
  <a target="_blank" href='https://github.com/CoderWanFeng/python-office'>
    <img src="https://img.shields.io/github/stars/CoderWanFeng/python-office.svg?style=social" alt="github star"/>
    </a>
    	<a target="_blank" href='https://gitee.com/CoderWanFeng//python-office/'>
		<img src='https://gitee.com/CoderWanFeng//python-office/badge/star.svg?theme=dark' alt='gitee star'/>
	</a>
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
		<img src='https://atomgit.com/CoderWanFeng1/python-office/star/2025top.svg?theme=dark' alt='atomgit star'/>
	</a>	
</p>
<p align="center" name="atomgit">
	<a href="https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ">
  <img src="https://img.shields.io/badge/å­¦ä¹ -AIç¼–ç¨‹-red" alt="AIç¼–ç¨‹">
</a>
    	<a href="http://www.python4office.cn/wechat-group/">
  <img src="https://img.shields.io/badge/åŠ å…¥-AIäº¤æµç¾¤-brightgreen" alt="AIäº¤æµç¾¤">
</a>

</p>

<!-- more -->



å¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ç¨‹åºå‘˜æ™šæ«ï¼Œæ­£åœ¨all in [AIç¼–ç¨‹å®æˆ˜](https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ)ï¼Œå…¨ç½‘åŒåã€‚


ï¼ˆ2.5 h ç›´æ’­ / å½•æ’­å¯æ‹† 2 æ¬¡ï¼‰

ç›®æ ‡  
â€¢ å½»åº•ç†è§£ `with` èƒŒåçš„ `__enter__ / __exit__`  
â€¢ èƒ½ç”¨ `contextlib` ä¸‰æ¿æ–§æŠŠ 10 è¡Œå†—ä½™ä»£ç å‹æˆ 1 è¡Œ  
â€¢ ç°åœºå†™ä¸€ä¸ªâ€œçº¿ç¨‹å®‰å…¨æ–‡ä»¶é”â€å·¥å…·åŒ…ï¼Œå¹¶æ‚„æ‚„æ¤å…¥ã€Œç¨‹åºå‘˜æ™šæ«ã€å½©è›‹

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.0 å¼€åœº 3 min  
â€œ99 % çš„ Python å¼€å‘è€…ç¬¬ä¸€æ¬¡ç”¨ `with open(...)` å°±çˆ±ä¸Šäº†å®ƒï¼Œä½† 90 % çš„äººæ²¡å†™è¿‡è‡ªå·±çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚â€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.1 åè®®å›é¡¾ï¼š`__enter__` / `__exit__`ï¼ˆ15 minï¼‰  
åŠ¨æ‰‹å†™ä¸€ä¸ªæœ€ç®€å•çš„è®¡æ—¶å™¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š

```python
import time

class Timer:
    def __enter__(self):
        self.start = time.perf_counter()
        return self  # è¿”å›çš„å¯¹è±¡ä¼šèµ‹ç»™ as åçš„å˜é‡

    def __exit__(self, exc_type, exc_val, tb):
        print(f"[è®¡æ—¶ç»“æŸ] è€—æ—¶ {time.perf_counter() - self.start:.4f}s")
        # è¿”å› True å¯ä»¥åæ‰å¼‚å¸¸ï¼Œé»˜è®¤ None é‡æ–°æŠ›å‡º
```

ç°åœºæµ‹è¯•ï¼š

```python
with Timer() as t:
    time.sleep(0.42)
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.2 contextlib ä¸‰æ¿æ–§ï¼ˆ25 minï¼‰  
3.2.1 `@contextmanager` å‡½æ•°è£…é¥°å™¨  
æŠŠä¸Šé¢ `Timer` æ”¹å†™æˆ 6 è¡Œï¼š

```python
from contextlib import contextmanager

@contextmanager
def timer():
    start = time.perf_counter()
    yield  # æŠŠå€¼æŠ›ç»™ as å˜é‡ï¼Œyield å‰ç›¸å½“äº __enter__
    print(f"[contextmanager] è€—æ—¶ {time.perf_counter()-start:.4f}s")
```

3.2.2 `contextlib.closing`  
æ¼”ç¤ºè‡ªåŠ¨å…³é—­ urllib è¿æ¥ï¼š

```python
from contextlib import closing
from urllib.request import urlopen

with closing(urlopen('https://www.baidu.com')) as resp:
    html = resp.read(100)
```

3.2.3 `ExitStack` åŠ¨æ€ç®¡ç†å¤šä¸ªèµ„æº  
åœºæ™¯ï¼šåŒæ—¶æ‰“å¼€ä¸ç¡®å®šæ•°é‡çš„æ–‡ä»¶ï¼Œæœ€åç»Ÿä¸€å…³é—­ï¼š

```python
from contextlib import ExitStack

with ExitStack() as stack:
    files = [stack.enter_context(open(f'data{i}.txt')) for i in range(10)]
    # ä»»æ„æ–‡ä»¶å¥æŸ„å¼‚å¸¸éƒ½ä¼šå…¨éƒ¨æ­£ç¡®å…³é—­
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.3 å®æˆ˜ï¼šçº¿ç¨‹å®‰å…¨æ–‡ä»¶é”ï¼ˆ45 minï¼‰  
éœ€æ±‚ï¼šå¤šä¸ªè¿›ç¨‹/çº¿ç¨‹å†™åŒä¸€æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ’ä»–é”ã€‚

3.3.1 æœ´ç´ å®ç°ï¼ˆå¸¦ bugï¼‰

```python
import fcntl, os, threading

class FileLock:
    def __init__(self, path):
        self.path = path
        self._f = None

    def __enter__(self):
        self._f = open(self.path, 'wb')  # ä»¥å†™æ¨¡å¼æ‰“å¼€
        fcntl.flock(self._f.fileno(), fcntl.LOCK_EX)
        return self

    def __exit__(self, *args):
        fcntl.flock(self._f.fileno(), fcntl.LOCK_UN)
        self._f.close()
```

3.3.2 åŠ æ—¥å¿— & ç¨‹åºå‘˜æ™šæ«å½©è›‹  
```python
import logging, datetime
logging.basicConfig(level=logging.INFO, format="%(message)s")
logger = logging.getLogger("ç¨‹åºå‘˜æ™šæ«çš„æ–‡ä»¶é”")

class FileLock:
    ...
    def __enter__(self):
        ...
        logger.info(f"[ç¨‹åºå‘˜æ™šæ«] {datetime.datetime.now():%H:%M:%S} å·²åŠ é” â†’ {self.path}")
        return self

    def __exit__(self, *args):
        ...
        logger.info(f"[ç¨‹åºå‘˜æ™šæ«] {datetime.datetime.now():%H:%M:%S} å·²é‡Šæ”¾ â† {self.path}")
```

3.3.3 æµ‹è¯•è„šæœ¬  
```python
import concurrent.futures, time

def write_log(i):
    with FileLock('app.log'):
        with open('app.log', 'a') as f:
            f.write(f'çº¿ç¨‹ {i} å†™å…¥ä¸€è¡Œ\n')
        time.sleep(0.1)

with concurrent.futures.ThreadPoolExecutor(10) as pool:
    pool.map(write_log, range(20))
```
è¿è¡Œåç»ˆç«¯ä¼šäº¤æ›¿å‡ºç°å¸¦ã€Œç¨‹åºå‘˜æ™šæ«ã€å­—æ ·çš„åŠ é”/é‡Šæ”¾æ—¥å¿—ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.4 å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å…ˆç¹ä¸ºå¿«ï¼ˆ15 minï¼‰  
æå‰é¢„å‘Šç¬¬ 7 ç« å†…å®¹ï¼š  
```python
import aiofiles
from contextlib import asynccontextmanager

@asynccontextmanager
async def open_async(path, mode='r'):
    f = await aiofiles.open(path, mode)
    try:
        yield f
    finally:
        await f.close()
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.5 è°ƒè¯•æŠ€å·§ï¼ˆ10 minï¼‰  
â€¢ PyCharm æ–­ç‚¹ï¼šåœ¨ `__exit__` çš„ `exc_type` ä¸Šæ‰“æ–­ç‚¹å¯æŸ¥çœ‹å¼‚å¸¸ã€‚  
â€¢ `contextlib.suppress` ä¼˜é›…å¿½ç•¥æŒ‡å®šå¼‚å¸¸ï¼š  
```python
from contextlib import suppress
with suppress(FileNotFoundError):
    os.remove('maybe_not_exist.txt')
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.6 å°ç»“ & æ€ç»´å¯¼å›¾ï¼ˆ5 minï¼‰  
`with` â†’ åè®® â†’ `contextlib` ä¸‰æ¿æ–§ â†’ è‡ªå®šä¹‰é” â†’ å¼‚æ­¥é¢„å‘Š

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
3.7 è¯¾åä½œä¸š  
1. å¿…åšï¼šæŠŠ `FileLock` æ‰©å±•ä¸ºè·¨å¹³å°çš„å®ç°ï¼ˆWindows ç”¨ `msvcrt.locking`ï¼‰ã€‚  
2. é€‰åšï¼šç”¨ `ExitStack` å†™ä¸€ä¸ªâ€œæ•°æ®åº“äº‹åŠ¡ + æ–‡ä»¶å¤‡ä»½â€æ··åˆä¸Šä¸‹æ–‡ã€‚  
3. å½©è›‹ï¼šåœ¨æ—¥å¿—è¾“å‡ºé‡ŒåŠ ã€Œç¨‹åºå‘˜æ™šæ«ã€ä¸“å± ASCII è‰ºæœ¯ Logoï¼ˆå¯åœ¨çº¿ç”Ÿæˆï¼‰ã€‚

æäº¤ï¼š  
â€¢ ä»£ç  push åˆ° `feat/lesson3`  
â€¢ CI è‡ªåŠ¨è·‘å¤šå¹³å°æµ‹è¯•ï¼ˆLinux/macOS/Windowsï¼‰

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
é™„å½•ï¼šä¸€è¡Œé€ŸæŸ¥  
| éœ€æ±‚               | æ¨èå†™æ³•                          |
|--------------------|-----------------------------------|
| è‡ªåŠ¨å…³é—­èµ„æº       | `@contextmanager` + `yield`       |
| æ‰¹é‡èµ„æºç»Ÿä¸€æ¸…ç†   | `ExitStack`                       |
| å¿½ç•¥å¼‚å¸¸           | `contextlib.suppress(Exception)`  |
| çº¿ç¨‹å®‰å…¨æ–‡ä»¶é”     | æœ¬è¯¾ `FileLock` æ¨¡æ¿              |

ï¼ˆç¬¬ 3 è®²å®Œï¼‰

----

å¤§å®¶åœ¨å­¦ä¹ è¯¾ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿+å¾®ä¿¡å’Œæˆ‘äº¤æµğŸ‘‰[æˆ‘çš„è”ç³»æ–¹å¼ï¼šå¾®ä¿¡ã€è¯»è€…ç¾¤ã€1å¯¹1ã€ç¦åˆ©](http://www.python4office.cn/wechat-qrcode/)


![](https://cos.python-office.com/ads/gzh/sub-py.jpg)

![æ‰«ä¸€æ‰«ï¼Œé¢†çº¢åŒ…](https://raw.atomgit.com/user-images/assets/5027920/fad13012-c22f-4c3a-b56e-c70787a55699/172ca166340cd6d0f52d356402901d4f.jpg '6152d8017a3595256e51cbd9e08e148b.png')
  
![ç¾å›¢çº¢åŒ…](https://raw.atomgit.com/user-images/assets/5027920/6aa9a60e-bb4a-423c-a75d-cbd6ecf6f370/4dbea2fec93c415c75311666f19a1022.jpg '6d283319df13b09a3f74a9f19bf18a97.jpg')





ç¨‹åºå‘˜æ™šæ«ä¸“æ³¨AIç¼–ç¨‹åŸ¹è®­ï¼Œå°ç™½çœ‹å®Œä»–çš„æ•™ç¨‹[ã€Š30è®² Â· AIç¼–ç¨‹è®­ç»ƒè¥ã€‹](https://mp.weixin.qq.com/s/uxCILtn9cfIsJR8PqOxlGQ)å°±èƒ½ä¸Šæ‰‹åšAIé¡¹ç›®ã€‚