---
title: ç¬¬ 7 è®² å¹¶å‘æ¨¡å‹æŠ‰æ‹©  
date: 2025-07-20 07:41:49
tags: [ç¬¬ä¸‰æ–¹åº“,pyinstaller]
---




<p align="center" id='è¿›ç¾¤-banner-AI'>
    <a target="_blank" href='http://www.python4office.cn/wechat-group/'>
    <img src="https://raw.atomgit.com/user-images/assets/5027920/87fc1ca4-1a6c-47b8-b234-3e323a1aa827/aiq.jpg" width="100%"/>
    </a>   
</p>

<p align="center">
	ğŸ‘‰ <a target="_blank" href="https://www.python-office.com/">é¡¹ç›®å®˜ç½‘ï¼šhttps://www.python-office.com/</a> ğŸ‘ˆ
</p>
<p align="center">
	ğŸ‘‰ <a target="_blank" href="http://www.python4office.cn/wechat-group/">æœ¬å¼€æºé¡¹ç›®çš„äº¤æµç¾¤</a> ğŸ‘ˆ
</p>



<p align="center" name="atomgit">
  <a target="_blank" href='https://github.com/CoderWanFeng/python-office'>
    <img src="https://img.shields.io/github/stars/CoderWanFeng/python-office.svg?style=social" alt="github star"/>
    </a>
    	<a target="_blank" href='https://gitee.com/CoderWanFeng//python-office/'>
		<img src='https://gitee.com/CoderWanFeng//python-office/badge/star.svg?theme=dark' alt='gitee star'/>
	</a>
	<a target="_blank" href='https://atomgit.com/CoderWanFeng1/python-office'>
		<img src='https://atomgit.com/CoderWanFeng1/python-office/star/2025top.svg?theme=dark' alt='atomgit star'/>
	</a>	
</p>
<p align="center" name="atomgit">
	<a href="https://mp.weixin.qq.com/s/b6fpU-oXSo8qKP_Nc8w0Zg">
  <img src="https://img.shields.io/badge/å­¦ä¹ -AIç¼–ç¨‹-red" alt="AIç¼–ç¨‹">
</a>
    	<a href="http://www.python4office.cn/wechat-group/">
  <img src="https://img.shields.io/badge/åŠ å…¥-AIäº¤æµç¾¤-brightgreen" alt="AIäº¤æµç¾¤">
</a>

</p>

<!-- more -->



å¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ç¨‹åºå‘˜æ™šæ«ï¼Œæ­£åœ¨all in [å„ç§AIé¡¹ç›®](https://mp.weixin.qq.com/s/XQhCrkbumDqtOZXuapMpVg)ï¼Œå…¨ç½‘åŒåã€‚


ï¼ˆ4 h ç›´æ’­ / å½•æ’­å¯æ‹† 2Ã—2 hï¼‰

ç›®æ ‡  
â€¢ ä¸€çœ¼åˆ¤æ–­ã€Œçº¿ç¨‹ / è¿›ç¨‹ / åç¨‹ã€è¯¥ç”¨è°  
â€¢ æŒæ¡ `concurrent.futures`ã€`asyncio` çš„ 80 % é«˜é¢‘æ¥å£  
â€¢ äº²æ‰‹å†™ä¸€ä¸ªã€ŒCPU å¯†é›† + I/O å¯†é›†ã€çš„æ··åˆçˆ¬è™«ï¼Œå¹¶æ‚„æ‚„æ¤å…¥ã€Œç¨‹åºå‘˜æ™šæ«ã€å½©è›‹

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.0 å¼€åœº 3 min  
â€œå¹¶å‘ä¸éš¾ï¼Œéš¾çš„æ˜¯é€‰é”™æ¨¡å‹ï¼›é€‰é”™æ¨¡å‹ï¼ŒåŠ ç­åˆ°å¤´å‘æ‰å…‰ã€‚â€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.1 ä¸€å¼ å›¾çœ‹æ‡‚ GILï¼ˆ10 minï¼‰  
â€¢ CPU å¯†é›† â†’ å¤šè¿›ç¨‹  
â€¢ I/O å¯†é›† â†’ å¤šçº¿ç¨‹ / åç¨‹  
ç°åœº benchmarkï¼š  
```bash
poetry add pytest-benchmark
python -m pytest tests/test_gil.py --benchmark-only
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.2 concurrent.futures ä¸‰æ¿æ–§ï¼ˆ25 minï¼‰  
7.2.1 ThreadPoolExecutorï¼š30 è¡Œå¹¶å‘ä¸‹è½½å™¨  

```python
import requests, concurrent.futures, time

URLS = [...]  # 200 å¼ å›¾ç‰‡

def fetch(url):
    r = requests.get(url, timeout=10)
    return url, len(r.content)

start = time.perf_counter()
with concurrent.futures.ThreadPoolExecutor(max_workers=20) as pool:
    for url, size in pool.map(fetch, URLS):
        print(url, size)
print("æ€»è€—æ—¶", time.perf_counter() - start)
```

7.2.2 ProcessPoolExecutorï¼šä¸€è¡Œåˆ‡æ¢  
```python
with concurrent.futures.ProcessPoolExecutor() as pool:
    ...
```

7.2.3 Future å›è°ƒ  
```python
future = pool.submit(fetch, url)
future.add_done_callback(lambda f: print("ç¨‹åºå‘˜æ™šæ«æé†’ä½ ï¼šä»»åŠ¡å®Œæˆ", f.result()))
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.3 asyncio æ ¸å¿ƒæ¨¡å‹ï¼ˆ40 minï¼‰  
7.3.1 event loopã€awaitã€Taskã€Future  
7.3.2 å†™ async çˆ¬è™«ï¼ˆaiohttpï¼‰  

```python
import aiohttp, asyncio, time

async def fetch(session, url):
    async with session.get(url) as resp:
        return url, len(await resp.read())

async def main():
    async with aiohttp.ClientSession(connector=aiohttp.TCPConnector(ssl=False)) as s:
        tasks = [asyncio.create_task(fetch(s, u)) for u in URLS]
        for coro in asyncio.as_completed(tasks):
            url, size = await coro
            print(url, size)

if __name__ == '__main__':
    asyncio.run(main())
```

7.3.3 Semaphore é™é€Ÿ & å½©è›‹  
```python
sem = asyncio.Semaphore(10)
async with sem:
    ...
print("ç¨‹åºå‘˜æ™šæ«çš„é™é€Ÿå°æç¤ºï¼šSemaphore=10ï¼Œå° IP è¿œç¦»ä½ ")
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.4 æ··åˆå¹¶å‘ï¼šCPU + I/Oï¼ˆ30 minï¼‰  
åœºæ™¯ï¼šçˆ¬å–ç½‘é¡µåï¼ŒCPU å¯†é›†åœ°è§£æ + è®¡ç®—å“ˆå¸Œã€‚  

```python
import asyncio, aiohttp, hashlib, concurrent.futures

loop = asyncio.get_running_loop()
executor = concurrent.futures.ProcessPoolExecutor()

def cpu_hash(text):
    return hashlib.sha256(text.encode()).hexdigest()[:8]

async def fetch_and_hash(session, url):
    async with session.get(url) as resp:
        text = await resp.text()
        h = await loop.run_in_executor(executor, cpu_hash, text)
        return url, h

async def main():
    async with aiohttp.ClientSession() as s:
        tasks = [fetch_and_hash(s, u) for u in URLS]
        for url, h in await asyncio.gather(*tasks):
            print(url, h)

asyncio.run(main())
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.5 å¹¶å‘è°ƒè¯•å·¥å…·ç®±ï¼ˆ20 minï¼‰  
â€¢ `asyncio.run()` vs `asyncio.create_task()` æ³„æ¼æ’æŸ¥  
â€¢ `trio` é«˜é˜¶ nurseryï¼ˆé€‰è¯»ï¼‰  
â€¢ `py-spy top` å®æ—¶ç«ç„°å›¾

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.6 ç»¼åˆæ¡ˆä¾‹ï¼šé«˜å¹¶å‘ç«¯å£æ‰«æå™¨ï¼ˆ30 minï¼‰  

```python
import asyncio, aiodns, time

async def check_port(ip, port, sem):
    async with sem:
        try:
            _, writer = await asyncio.wait_for(
                asyncio.open_connection(ip, port), timeout=0.5
            )
            writer.close()
            print(f"[ç¨‹åºå‘˜æ™šæ«] {ip}:{port} å¼€æ”¾")
            return port
        except:
            return None

async def scan(ip, ports):
    sem = asyncio.Semaphore(500)
    tasks = [check_port(ip, p, sem) for p in ports]
    return [p for p in await asyncio.gather(*tasks) if p]

if __name__ == '__main__':
    start = time.perf_counter()
    open_ports = asyncio.run(scan('127.0.0.1', range(1, 1025)))
    print("å¼€æ”¾ç«¯å£:", open_ports, "è€—æ—¶", time.perf_counter() - start)
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.7 å°ç»“ & æ€ç»´å¯¼å›¾ï¼ˆ5 minï¼‰  
GIL â†’ ThreadPoolExecutor / ProcessPoolExecutor â†’ asyncio â†’ æ··åˆ â†’ è°ƒè¯•

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
7.8 è¯¾åä½œä¸š  
1. å¿…åšï¼šæŠŠä»Šæ—¥ç«¯å£æ‰«æå™¨æ”¹é€ æˆã€Œåç¨‹ + è¿›ç¨‹ã€æ··åˆæ¨¡å¼ï¼Œè¾“å‡ºè€—æ—¶å¯¹æ¯”è¡¨ã€‚  
2. é€‰åšï¼šç”¨ `trio` é‡å†™åŒä¸€æ‰«æå™¨ï¼Œæ¯”è¾ƒ API å·®å¼‚ã€‚  
3. å½©è›‹ï¼šåœ¨æ‰«æç»“æœé‡Œéšæœºæ‰“å°ã€Œç¨‹åºå‘˜æ™šæ«ã€çš„å½©è‰² logoï¼ˆ`rich` åº“ï¼‰ã€‚

æäº¤ï¼š  
â€¢ ä»£ç  push åˆ° `feat/lesson7`  
â€¢ CI è‡ªåŠ¨è·‘ `pytest-asyncio` + `bandit` å®‰å…¨æ£€æŸ¥

ï¼ˆç¬¬ 7 è®²å®Œï¼‰


----

å¤§å®¶åœ¨å­¦ä¹ è¯¾ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿+å¾®ä¿¡å’Œæˆ‘äº¤æµğŸ‘‰[æˆ‘çš„è”ç³»æ–¹å¼ï¼šå¾®ä¿¡ã€è¯»è€…ç¾¤ã€1å¯¹1ã€ç¦åˆ©](http://www.python4office.cn/wechat-qrcode/)


![](https://cos.python-office.com/ads/gzh/sub-py.jpg)

![æ‰«ä¸€æ‰«ï¼Œé¢†çº¢åŒ…](https://raw.atomgit.com/user-images/assets/5027920/fad13012-c22f-4c3a-b56e-c70787a55699/172ca166340cd6d0f52d356402901d4f.jpg '6152d8017a3595256e51cbd9e08e148b.png')
  
![ç¾å›¢çº¢åŒ…](https://raw.atomgit.com/user-images/assets/5027920/6aa9a60e-bb4a-423c-a75d-cbd6ecf6f370/4dbea2fec93c415c75311666f19a1022.jpg '6d283319df13b09a3f74a9f19bf18a97.jpg')





ç¨‹åºå‘˜æ™šæ«ä¸“æ³¨AIç¼–ç¨‹åŸ¹è®­ï¼Œå°ç™½çœ‹å®Œä»–çš„æ•™ç¨‹[ã€Š30è®² Â· AIç¼–ç¨‹è®­ç»ƒè¥ã€‹](https://mp.weixin.qq.com/s/b6fpU-oXSo8qKP_Nc8w0Zg)å°±èƒ½ä¸Šæ‰‹åšAIé¡¹ç›®ã€‚